<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Precious Time Cinema - Parent Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide-static@0.321.0/lib/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: black; color: white; }
        
        /* Smooth scrolling */
        html { scroll-behavior: smooth; }

        /* Hide scrollbar for clean UI */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .custom-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #22d3ee;
            cursor: pointer;
            border-radius: 50%;
            border: 4px solid #000;
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.4);
        }
        
        .movie-card { transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .movie-card:hover { transform: translateY(-8px); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/javascript">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        // PASTE YOUR TMDB API KEY BETWEEN THE QUOTES BELOW
        const apiKey = "596a0c391f0dbb0641e881ceb9994976"; 

        const PLATFORMS = [
            { id: 8, name: "Netflix" },
            { id: 15, name: "Hulu" },
            { id: 9, name: "Prime" },
            { id: 337, name: "Disney+" },
            { id: 1899, name: "Max" },
            { id: 531, name: "Paramount+" },
            { id: 350, name: "Apple TV+" },
            { id: 2, name: "Apple Rental" } 
        ];

        const GENRES = [
            { id: 0, name: "All" },
            { id: 28, name: "Action" },
            { id: 35, name: "Comedy" },
            { id: 18, name: "Drama" },
            { id: 27, name: "Horror" },
            { id: 878, name: "Sci-Fi" },
            { id: 53, name: "Thriller" },
            { id: 99, name: "Documentary" },
            { id: 12, name: "Adventure" },
            { id: 16, name: "Animation" }
        ];

        function App() {
            const [maxTime, setMaxTime] = useState(100);
            const [minRating, setMinRating] = useState(6); // Default 6 stars
            const [selectedGenre, setSelectedGenre] = useState(0);
            const [userPlatforms, setUserPlatforms] = useState([8, 15, 9, 337]);
            const [showFilters, setShowFilters] = useState(false);
            const [movies, setMovies] = useState([]);
            
            const [page, setPage] = useState(Math.floor(Math.random() * 5) + 1);
            
            const [loading, setLoading] = useState(true);
            const [loadingMore, setLoadingMore] = useState(false);
            const [error, setError] = useState(null);

            const timeoutRef = useRef(null);

            const fetchMovies = useCallback(async (pageNum, append = false) => {
                if (!apiKey) {
                    setError("API Key Missing. Please edit the index.html file and add your key.");
                    setLoading(false);
                    return;
                }

                if (userPlatforms.length === 0) {
                    setError("Please select at least one streaming service.");
                    setMovies([]);
                    setLoading(false);
                    return;
                }

                try {
                    if (append) setLoadingMore(true); else setLoading(true);
                    setError(null);
                    
                    const providerString = userPlatforms.join('|'); 

                    const baseUrl = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}`;
                    const params = [
                        `page=${pageNum}`,
                        `with_runtime.lte=${maxTime}`,
                        `with_runtime.gte=60`, 
                        `vote_count.gte=50`,   
                        `vote_average.gte=${minRating}`, // ADDED QUALITY FILTER
                        `sort_by=popularity.desc`,
                        `watch_region=US`,
                        `with_watch_monetization_types=flatrate|rent|buy`, 
                        `with_watch_providers=${providerString}`
                    ];

                    if (selectedGenre !== 0) params.push(`with_genres=${selectedGenre}`);
                    
                    const response = await fetch(`${baseUrl}&${params.join('&')}`);
                    if (!response.ok) throw new Error('Failed to fetch catalog');
                    const data = await response.json();
                    
                    const detailedMovies = await Promise.all(
                        data.results.map(async (m) => {
                            try {
                                const detailUrl = `https://api.themoviedb.org/3/movie/${m.id}?api_key=${apiKey}&append_to_response=watch/providers`;
                                const detailRes = await fetch(detailUrl);
                                const d = await detailRes.json();
                                
                                if (d.runtime > maxTime) return null;

                                const allProviders = d['watch/providers']?.results?.US?.flatrate || [];
                                const rentalProviders = d['watch/providers']?.results?.US?.rent || [];
                                const combined = [...allProviders, ...rentalProviders];
                                
                                const myProviders = combined.filter(p => userPlatforms.includes(p.provider_id));

                                return {
                                    id: m.id,
                                    title: m.title,
                                    runtime: d.runtime || 0,
                                    providers: myProviders, 
                                    rating: m.vote_average.toFixed(1),
                                    year: m.release_date ? new Date(m.release_date).getFullYear() : 'N/A',
                                    description: m.overview,
                                    poster: m.poster_path ? `https://image.tmdb.org/t/p/w500${m.poster_path}` : null,
                                    backdrop: m.backdrop_path ? `https://image.tmdb.org/t/p/w1280${m.backdrop_path}` : null,
                                    tmdbUrl: `https://www.themoviedb.org/movie/${m.id}`
                                };
                            } catch (e) { return null; }
                        })
                    );

                    const validMovies = detailedMovies.filter(m => m !== null);
                    
                    setMovies(prev => {
                        if (!append) return validMovies;
                        const newIds = new Set(validMovies.map(m => m.id));
                        return [...prev, ...validMovies.filter(m => !prev.find(p => p.id === m.id))];
                    });
                    
                    setLoading(false);
                    setLoadingMore(false);
                } catch (err) {
                    setError("Could not load library. Check API key.");
                    setLoading(false);
                    setLoadingMore(false);
                }
            }, [maxTime, selectedGenre, userPlatforms, minRating, apiKey]);

            // TRIGGER: When filters change, reset page and fetch
            useEffect(() => {
                if (timeoutRef.current) clearTimeout(timeoutRef.current);
                
                timeoutRef.current = setTimeout(() => {
                    const randomStartPage = Math.floor(Math.random() * 3) + 1; 
                    setPage(randomStartPage);
                    fetchMovies(randomStartPage, false);
                }, 500);

                return () => clearTimeout(timeoutRef.current);
            }, [maxTime, selectedGenre, userPlatforms, minRating, fetchMovies]);

            const handleLoadMore = () => {
                const nextPage = page + 1;
                setPage(nextPage);
                fetchMovies(nextPage, true);
            };

            const togglePlatform = (id) => {
                setUserPlatforms(prev => {
                    const newPlatforms = prev.includes(id) 
                        ? prev.filter(x => x !== id) 
                        : [...prev, id];
                    return newPlatforms;
                });
            };

            return React.createElement('div', { className: "min-h-screen pb-20 bg-black text-white" }, [
                // Background
                React.createElement('div', { key: 'bg', className: "fixed inset-0 overflow-hidden pointer-events-none -z-10" }, [
                    React.createElement('div', { className: "absolute -top-1/4 -left-1/4 w-1/2 h-1/2 bg-indigo-900/20 blur-[150px] rounded-full" }),
                    React.createElement('div', { className: "absolute bottom-0 right-0 w-1/2 h-1/2 bg-cyan-900/10 blur-[150px] rounded-full" })
                ]),

                // Header
                React.createElement('header', { key: 'header', className: "max-w-7xl mx-auto px-4 pt-10 md:pt-16 mb-8" }, [
                    React.createElement('div', { className: "flex flex-col md:flex-row md:items-end justify-between gap-8" }, [
                        React.createElement('div', null, [
                            React.createElement('div', { className: "flex items-center gap-3 mb-4" }, [
                                React.createElement('span', { className: "bg-cyan-500 text-black px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest" }, "Parent Mode Active")
                            ]),
                            React.createElement('h1', { className: "text-5xl md:text-6xl font-black tracking-tighter mb-4" }, [
                                "Precious ", React.createElement('span', { className: "text-cyan-400" }, "Time")
                            ]),
                            React.createElement('p', { className: "text-neutral-400 text-lg max-w-xl leading-relaxed" }, 
                                "Your movie time is precious, but so is your sleep."
                            )
                        ]),
                        React.createElement('div', { className: "flex gap-2" }, [
                            React.createElement('button', { 
                                onClick: () => {
                                    const randomPage = Math.floor(Math.random() * 10) + 1;
                                    setPage(randomPage);
                                    fetchMovies(randomPage, false);
                                },
                                className: "flex items-center gap-2 px-6 py-4 rounded-2xl bg-neutral-900 border border-neutral-800 hover:border-cyan-500 transition-all font-bold text-sm"
                            }, "ðŸ”€ Shuffle"),
                            React.createElement('button', { 
                                onClick: () => setShowFilters(!showFilters),
                                className: `group flex items-center gap-2 px-6 py-4 rounded-2xl border-2 font-black transition-all ${showFilters ? "bg-white text-black border-white" : "bg-transparent text-white border-neutral-800 hover:border-cyan-500"}`
                            }, [
                                "FILTERS",
                                React.createElement('span', { className: "bg-neutral-800 text-white px-2 py-0.5 rounded text-xs" }, userPlatforms.length)
                            ])
                        ])
                    ])
                ]),

                // Filters Overlay (Now includes Quality)
                showFilters && React.createElement('div', { key: 'platform-overlay', className: "max-w-7xl mx-auto px-4 mb-12 animate-in fade-in slide-in-from-top-4" }, [
                    React.createElement('div', { className: "p-8 rounded-3xl bg-neutral-900/80 border border-neutral-800 backdrop-blur-xl" }, [
                        
                        // Quality Filter Section
                        React.createElement('div', { className: "mb-8 pb-8 border-b border-white/10" }, [
                            React.createElement('div', { className: "flex justify-between items-center mb-4" }, [
                                React.createElement('h3', { className: "font-bold text-xl text-cyan-400" }, "Minimum Quality Score"),
                                React.createElement('span', { className: "text-xl font-black" }, `${minRating}+ Stars`)
                            ]),
                            React.createElement('input', {
                                type: 'range', min: 0, max: 9, step: 0.5, value: minRating,
                                onChange: (e) => setMinRating(parseFloat(e.target.value)),
                                className: "w-full h-2 bg-neutral-800 rounded-full appearance-none cursor-pointer custom-range"
                            }),
                            React.createElement('div', { className: "flex justify-between mt-2 text-xs font-bold text-neutral-500" }, [
                                React.createElement('span', null, "Anything Goes (0)"),
                                React.createElement('span', null, "Masterpieces Only (9)")
                            ])
                        ]),

                        // Services Section
                        React.createElement('h3', { className: "font-bold text-xl mb-6 text-cyan-400" }, "Select Your Subscriptions"),
                        React.createElement('div', { className: "grid grid-cols-2 sm:grid-cols-4 md:grid-cols-8 gap-4" }, PLATFORMS.map(p => 
                            React.createElement('button', {
                                key: p.id,
                                onClick: () => togglePlatform(p.id),
                                className: `flex flex-col items-center justify-center gap-2 p-4 rounded-2xl border-2 transition-all ${userPlatforms.includes(p.id) ? "bg-cyan-500/10 border-cyan-500 text-cyan-400" : "bg-black border-neutral-800 text-neutral-600 grayscale hover:grayscale-0"}`
                            }, [
                                React.createElement('span', { className: "text-xs font-black uppercase tracking-tighter text-center" }, p.name)
                            ])
                        ))
                    ])
                ]),

                // Controls
                React.createElement('div', { key: 'controls', className: "sticky top-4 z-50 max-w-7xl mx-auto px-4 mb-12" }, [
                    React.createElement('div', { className: "bg-neutral-900/95 border border-white/10 backdrop-blur-2xl rounded-3xl p-6 shadow-2xl flex flex-col lg:flex-row gap-8 items-center" }, [
                        React.createElement('div', { className: "w-full lg:w-1/2" }, [
                            React.createElement('div', { className: "flex justify-between items-end mb-4" }, [
                                React.createElement('div', null, [
                                    React.createElement('span', { className: "text-[10px] font-black text-neutral-500 uppercase tracking-widest" }, "Available Time"),
                                    React.createElement('div', { className: "text-3xl font-black text-cyan-400" }, `${maxTime} min`)
                                ]),
                                React.createElement('div', { className: "text-right" }, [
                                    React.createElement('span', { className: "text-[10px] font-black text-neutral-500 uppercase tracking-widest" }, "Bedtime"),
                                    React.createElement('div', { className: "text-xl font-mono text-white/60" }, 
                                        new Date(Date.now() + maxTime * 60000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                                    )
                                ])
                            ]),
                            React.createElement('input', {
                                type: 'range', min: 70, max: 210, step: 5, value: maxTime,
                                onChange: (e) => setMaxTime(parseInt(e.target.value)),
                                className: "w-full h-2 bg-neutral-800 rounded-full appearance-none cursor-pointer custom-range"
                            })
                        ]),
                        React.createElement('div', { className: "w-full lg:w-1/2 overflow-x-auto pb-2 flex gap-2 no-scrollbar" }, GENRES.map(g => 
                            React.createElement('button', {
                                key: g.id,
                                onClick: () => setSelectedGenre(g.id),
                                className: `flex-shrink-0 px-5 py-3 rounded-xl text-xs font-black transition-all ${selectedGenre === g.id ? "bg-cyan-500 text-black shadow-lg shadow-cyan-500/20" : "bg-neutral-800 text-neutral-400 hover:bg-neutral-700"}`
                            }, g.name.toUpperCase())
                        ))
                    ])
                ]),

                // Grid
                React.createElement('main', { key: 'main', className: "max-w-7xl mx-auto px-4" }, [
                    loading ? React.createElement('div', { className: "flex flex-col items-center justify-center py-40 text-neutral-500 gap-4" }, [
                        React.createElement('div', { className: "w-12 h-12 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin" }),
                        React.createElement('p', { className: "font-black text-sm uppercase tracking-widest" }, "Searching all apps...")
                    ]) :
                    error ? React.createElement('div', { className: "text-center py-40" }, [
                        React.createElement('p', { className: "text-red-400 text-2xl font-bold mb-4" }, error),
                        React.createElement('button', { onClick: () => fetchMovies(1), className: "bg-white text-black px-8 py-3 rounded-full font-black" }, "RETRY")
                    ]) :
                    React.createElement('div', null, [
                        React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" }, movies.map(movie => 
                            React.createElement('div', { key: movie.id, className: "movie-card relative flex flex-col bg-neutral-900/40 rounded-[2.5rem] overflow-hidden border border-white/5 hover:border-cyan-500/30 group" }, [
                                React.createElement('div', { className: "relative h-64 overflow-hidden" }, [
                                    React.createElement('img', { 
                                        src: movie.poster || movie.backdrop, 
                                        className: "w-full h-full object-cover transition-transform duration-700 group-hover:scale-110",
                                        loading: "lazy"
                                    }),
                                    React.createElement('div', { className: "absolute inset-0 bg-gradient-to-t from-neutral-900 via-transparent" }),
                                    React.createElement('div', { className: "absolute top-4 right-4 bg-black/60 backdrop-blur-md px-3 py-1.5 rounded-full border border-white/10 flex items-center gap-1.5" }, [
                                        React.createElement('span', { className: "text-yellow-500 text-xs" }, "â˜…"),
                                        React.createElement('span', { className: "text-[10px] font-black" }, movie.rating)
                                    ]),
                                    React.createElement('div', { className: "absolute bottom-4 left-6" }, [
                                        React.createElement('span', { className: "bg-cyan-500 text-black px-2 py-0.5 rounded text-[10px] font-black uppercase" }, `${movie.runtime} MIN`)
                                    ])
                                ]),
                                React.createElement('div', { className: "p-6 flex-grow flex flex-col" }, [
                                    React.createElement('div', { className: "flex justify-between items-center mb-2" }, [
                                        React.createElement('span', { className: "text-neutral-500 text-[10px] font-black" }, movie.year),
                                    ]),
                                    React.createElement('h3', { className: "text-lg font-black mb-3 leading-tight group-hover:text-cyan-400 transition-colors" }, movie.title),
                                    React.createElement('p', { className: "text-neutral-500 text-xs line-clamp-3 leading-relaxed mb-6" }, movie.description),
                                    React.createElement('div', { className: "mt-auto flex items-center justify-between" }, [
                                        // Icons Logic with "RENT" differentiation
                                        React.createElement('div', { className: "flex -space-x-4" }, 
                                            movie.providers.length > 0 ? movie.providers.slice(0, 4).map((p, i) => React.createElement('div', { key: i, className: "relative" }, [
                                                React.createElement('img', { 
                                                    src: `https://image.tmdb.org/t/p/original${p.logo_path}`,
                                                    title: p.provider_name,
                                                    className: "w-12 h-12 rounded-full border-2 border-neutral-900 shadow-lg object-cover bg-neutral-800"
                                                }),
                                                // Check for Apple Rental (ID 2) and add badge
                                                p.provider_id === 2 && React.createElement('span', { 
                                                    className: "absolute -bottom-1 -right-1 bg-cyan-500 text-[6px] font-black text-black px-1.5 py-0.5 rounded-full border border-white" 
                                                }, "RENT")
                                            ])) : React.createElement('span', { className: "text-[10px] text-neutral-600" }, "Rent/Buy")
                                        ),
                                        React.createElement('a', { 
                                            href: movie.tmdbUrl,
                                            target: "_blank",
                                            rel: "noopener noreferrer",
                                            className: "text-[10px] font-black tracking-widest uppercase text-white/40 hover:text-cyan-400 transition-colors" 
                                        }, "Info â†’")
                                    ])
                                ])
                            ])
                        )),
                        
                        movies.length > 0 && React.createElement('div', { className: "mt-20 flex flex-col items-center gap-6" }, [
                            React.createElement('button', { 
                                onClick: handleLoadMore,
                                disabled: loadingMore,
                                className: "px-12 py-5 rounded-full bg-neutral-900 border border-white/10 hover:border-cyan-500 font-black text-sm tracking-widest transition-all hover:scale-105 disabled:opacity-50"
                            }, loadingMore ? "LOADING..." : "LOAD MORE")
                        ])
                    ])
                ]),

                React.createElement('footer', { key: 'footer', className: "max-w-7xl mx-auto px-4 mt-40 text-center pb-10" }, [
                    React.createElement('p', { className: "text-neutral-700 text-[10px] font-black uppercase tracking-[0.3em]" }, 
                        "Precious Time Cinema v2.0"
                    )
                ])
            ]);
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>

